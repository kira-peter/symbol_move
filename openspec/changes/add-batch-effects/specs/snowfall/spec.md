# 雪花飘落特效规格

## 特效 ID
snowfall

## 概述
模拟雪花从上到下飘落的冬日场景，雪花有不同形状和飘落速度，营造浪漫的氛围。

## 需求

### R1: 雪花生成
系统应持续生成新的雪花从顶部落下。

**场景**：
- S1.1 雪花从顶部随机位置生成
- S1.2 使用多种字符表示雪花：`❅`、`❆`、`*`、`·`、`•`
- S1.3 生成速率根据密度配置调整
- S1.4 雪花初始 X 坐标随机分布

### R2: 飘落动画
雪花应呈现自然的飘落效果。

**场景**：
- S2.1 雪花垂直向下移动（Y 坐标增加）
- S2.2 每片雪花有独立的下落速度（0.5-2.0 单位/秒）
- S2.3 雪花水平位置有轻微摆动（模拟风吹效果）
- S2.4 摆动幅度为 -1 到 +1 个字符位置
- S2.5 雪花到达底部后消失并回收

### R3: 密度控制
支持调整雪花密集程度。

**场景**：
- S3.1 稀疏模式：每帧生成 0-2 片雪花
- S3.2 中等模式：每帧生成 1-5 片雪花
- S3.3 密集模式：每帧生成 3-10 片雪花
- S3.4 屏幕上同时存在的雪花数量有合理上限

### R4: 视觉效果
雪花应有层次感和深度感。

**场景**：
- S4.1 近处的雪花（快速、大字符、亮色）
- S4.2 远处的雪花（慢速、小字符、暗色）
- S4.3 颜色使用白色、亮白、淡蓝、灰色
- S4.4 不同层次的雪花混合渲染

### R5: 性能要求
特效应流畅且低资源占用。

**场景**：
- S5.1 目标帧率：30 FPS
- S5.2 CPU 占用 < 25%
- S5.3 内存占用 < 15 MB
- S5.4 支持终端大小 80x24 到 200x60
- S5.5 雪花数量上限：500 片

### R6: 交互控制
支持基本用户交互。

**场景**：
- S6.1 ESC 键退出特效
- S6.2 终端调整大小时适配
- S6.3 Ctrl+C 强制退出

### R7: 代码质量
代码清晰易维护。

**场景**：
- S7.1 实现 Effect 接口
- S7.2 自动注册到特效表
- S7.3 配置化设计（密度、速度）
- S7.4 适当的错误处理和日志

### R8: 扩展性
为未来功能预留扩展点。

**场景**：
- S8.1 支持添加风向控制（可选）
- S8.2 支持地面积雪效果（可选）
- S8.3 支持雪堆累积动画（可选）

## 技术约束
- 使用 tcell 进行终端渲染
- 使用正弦函数模拟水平摆动
- 雪花对象池复用以减少 GC 压力
- 帧率控制使用 time.Ticker

## 参考实现
参考 starry-sky 和 matrix-rain 的架构设计模式。
